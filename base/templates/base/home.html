{% extends 'main.html' %}

{% block content %}

{{ room_count|json_script:'roomcount' }}


</style>
<main class="layout layout--3" style="color: cornsilk;">
  <div id="aa1" class="container" name="{{room_count}}">
    <!-- Topics Start -->
    {% include 'base/topics_component.html' %}
    <!-- Topics End -->

    <!-- Room List Start -->
    <div class="roomList">
      <div class="mobile-menu">
        <form action="{% url 'home' %}" method="GET" class="header__search">
          <!-- GET is used for viewing something, without changing it, while POST is used for changing something -->
          <label id="mrs1">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
              <title>search</title>
              <path>
                d = "M32 30.586l-10.845-10.845c1.771-2.092 2.845-4.791 2.845-7.741 0-6.617-5.383-12-12-12s-12 5.383-12
                12c0 6.617 5.383 12 12 12 2.949 0 5.649-1.074 7.741-2.845l10.845 10.845 1.414-1.414zM12 22c-5.514
                0-10-4.486-10-10s4.486-10 10-10c5.514 0 10 4.486 10 10s-4.486 10-10 10z"
              </path>
            </svg>
            <input name='q' id="mrs" placeholder="Search for posts" autocomplete="off"/>
          </label>
        </form>
        <div class="mobile-menuItems">
          <a class="btn btn--main btn--pill" href="{% url 'topics' %}">Browse Topics</a>
          <a class="btn btn--main btn--pill" href="{% url 'home' %}?q=Lost items">Lost stuff</a>
          <a class="btn btn--main btn--pill" href="{% url 'activity-page' %}">Recent Activities</a>
        </div>
      </div>
      <div class="roomList__header">
        <div>
          <h2>Rooms</h2>
          <p>{{room_count}} available</p>
        </div>
        <a class="btn btn--main" href="{% url 'create-room' %}">
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
            <title>add</title>
            <path
              d="M16.943 0.943h-1.885v14.115h-14.115v1.885h14.115v14.115h1.885v-14.115h14.115v-1.885h-14.115v-14.115z">
            </path>
          </svg>
          Create Room
        </a> 
      </div>
      <style>
        button.btn p {
          text-align: center;
        }
      </style>
      {% include 'base/feed_component.html' %}

      <!-- Room List End -->
      {% if room_count > 4 %}
        <button style="position: absolute; text-align: center; font-size: 1.5rem;" id="LoadBtn" class="btn btn--main"><p style="padding-left: 44%; padding-right: 42%;">Load more</p></button>
        <div class="planet" id="plnt" style="display: none;"></div>
        <br>
        <br>
        <br>
        <br>
      {% endif %}
      </div>
      <style>

      .noselect{
        -webkit-touch-callout: none; /* iOS Safari */
        -webkit-user-select: none;   /* Chrome/Safari/Opera */
        -khtml-user-select: none;    /* Konqueror */
        -moz-user-select: none;      /* Firefox */
        -ms-user-select: none;       /* Internet Explorer/Edge */
        user-select: none;           /* Non-prefixed version,                                not supported by any browser */
        cursor: default;
        }

      .planet {
        margin-left: 45%;
        margin-right: 20%;
        display: block;
        width: 60px;
        height: 60px;
        position: relative;
        transform-style: preserve-3d;
        border-radius: 50%;
        background: #fcc96b;
        background: rgb(252, 201, 107);
        background: linear-gradient(
          180deg,
          rgba(252, 201, 107, 1) 0%,
          rgba(252, 201, 107, 1) 15%,
          rgba(247, 174, 1, 1) 15%,
          rgba(247, 174, 1, 1) 19%,
          rgba(252, 201, 107, 1) 19%,
          rgba(252, 201, 107, 1) 22%,
          rgba(247, 174, 1, 1) 22%,
          rgba(247, 174, 1, 1) 28%,
          rgba(252, 201, 107, 1) 28%,
          rgba(252, 201, 107, 1) 31%,
          rgba(252, 201, 107, 1) 33%,
          rgba(252, 201, 107, 1) 36%,
          rgba(247, 174, 1, 1) 36%,
          rgba(247, 174, 1, 1) 48%,
          rgba(252, 201, 107, 1) 48%,
          rgba(252, 201, 107, 1) 55%,
          rgba(247, 174, 1, 1) 55%,
          rgba(247, 174, 1, 1) 66%,
          rgba(252, 201, 107, 1) 66%,
          rgba(252, 201, 107, 1) 70%,
          rgba(247, 174, 1, 1) 70%,
          rgba(247, 174, 1, 1) 73%,
          rgba(252, 201, 107, 1) 73%,
          rgba(252, 201, 107, 1) 82%,
          rgba(247, 174, 1, 1) 82%,
          rgba(247, 174, 1, 1) 86%,
          rgba(252, 201, 107, 1) 86%
        );
        box-shadow: inset 0 0 25px rgba(0, 0, 0, 0.25),
          inset 8px -4px 6px rgba(199, 128, 0, 0.5),
          inset -8px 4px 8px rgba(255, 235, 199, 0.5),
          inset 20px -5px 12px #f7ae01,
          0 0 100px rgba(255, 255, 255, 0.35);
        transform: rotateZ(-15deg);
      }

      .planet::before {
        position: absolute;
        content: "";
        display: block;
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        border: 8px solid #7b6f42;
        border-top-width: 0;
        border-radius: 50%;
        box-shadow: 0 -2px 0 #b1a693;
        animation: rings1 0.8s infinite linear;
      }

      .planet::after {
        position: absolute;
        content: "";
        display: block;
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        border: 8px solid #b1a693;
        border-top-width: 0;
        border-radius: 50%;
        box-shadow: 0 -2px 0 #7b6f42;
        animation: rings2 0.8s infinite linear;
      }

      @keyframes rings1 {
        0% {
          transform: rotateX(65deg) rotateZ(0deg) scale(1.75);
        }
        100% {
          transform: rotateX(65deg) rotateZ(360deg) scale(1.75);
        }
      }

      @keyframes rings2 {
        0% {
          transform: rotateX(65deg) rotateZ(0deg) scale(1.7);
        }
        100% {
          transform: rotateX(65deg) rotateZ(360deg) scale(1.7);
        }
      }

      </style>

      <style>
        /* Center the loader */
        #loader {
          text-align: center;
          position: relative;
          left: 50%;
          top: 50%;
          z-index: 1;
          width: 30px;
          height: 30px;
          margin: -38px 0 0 -38px;
          border: 8px solid #f3f3f3;
          border-radius: 50%;
          border-top: 8px solid #3498db;
          -webkit-animation: spin 2s linear infinite;
          animation: spin 2s linear infinite;
        }
        
        @-webkit-keyframes spin {
          0% { -webkit-transform: rotate(0deg); }
          100% { -webkit-transform: rotate(360deg); }
        }
        
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        
        /* Add animation to "page content" */
        .animate-bottom {
          position: relative;
          -webkit-animation-name: animatebottom;
          -webkit-animation-duration: 1s;
          animation-name: animatebottom;
          animation-duration: 1s
        }
        
        @-webkit-keyframes animatebottom {
          from { bottom:-100px; opacity:0 } 
          to { bottom:0px; opacity:1 }
        }
        
        @keyframes animatebottom { 
          from{ bottom:-100px; opacity:0 } 
          to{ bottom:0; opacity:1 }
        }
        </style>
    <!-- Activities Start -->
    {% include 'base/activity_component.html' %}
    <!-- Activities End -->
  </div>
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
 
  <script>
    const roomListwidth = $(".roomList").width();
    function adjust_loadbtn () {
    $("#LoadBtn").css({'width' : $(".roomList").width()});
    // $("#LoadBtn").css({"text-align" : "center"});
    }
    var input = document.getElementById("mrs");
    input.addEventListener("focus", function () {
    document.getElementById("mrs1").style.backgroundColor = "var(--color-dark-medium-focus)";  
    });
    input.addEventListener("blur", function () {
    document.getElementById("mrs1").style.backgroundColor = "var(--color-dark-medium)";
    });
  </script>

  <script>
    window.addEventListener("resize", () => {
      adjust_loadbtn();
    })
  </script>
  
  <script>
    adjust_loadbtn();
    const roomcount = JSON.parse(document.getElementById("roomcount").textContent);
    var visible = 4; // => rooms[0:4]
    var i = 0;
    document.getElementById("LoadBtn").onclick = () => {
      // document.getElementById("plnt").scrollIntoView();
      // window.scrollTo(0, document.body.scrollHeight);
      $("html, body").animate({ scrollTop: $(document).height() }, 1000);
      $("#LoadBtn").css({"display":"none"});
      $(".planet").css({"display":"block"});
      const timee = setTimeout(mainn, 1000);

      function mainn() {
      $(".planet").css({"display":"none"});
      $("#LoadBtn").css({'display':'block', 'width' : $(".roomList").width()});
      // $("#LoadBtn").css({"text-align" : "center"});
      visible += 1;
      i += 1;
      $.ajax({
        url: "{% url 'loadmore' %}",
        type: "GET",
        data: {
          'visible': visible
        },
        dataType: 'json',
        success: function (dataa) {
          // if (visible = roomcount) {
          //   alert("No more rooms!");
          // }
        if (visible <= roomcount-1) {
          const newroomname = dataa["newroomname"];
          const newroomname1 = dataa["newroomname1"];
          var url_userprofile = "{% url 'userprofile' pk=12345 %}".replace(/12345/, dataa["newroomhostid"].toString());
          var url_userprofile1 = "{% url 'userprofile' pk=12345 %}".replace(/12345/, dataa["newroomhostid1"].toString());
          var url_room = "{% url 'room' pk=12345 %}".replace(/12345/, dataa["newroomid"].toString());
          var url_room1 = "{% url 'room' pk=12345 %}".replace(/12345/, dataa["newroomid1"].toString());
          $(`<div class="roomListRoom" name="roomss">
  <div class="roomListRoom__header">
    <a href=${url_userprofile} class="roomListRoom__author">
      <div class="avatar avatar--small">
        <img src=${dataa["newroomhostavatar"]} />
      </div>
      <span>@${dataa["newroomhost"]}</span>
    </a>
      <div id="iht" class="roomListRoom__actions" name="1a1">
      <span id="iht1"> ${dataa["roomgettimedifference"]} ago </span>
      </div>
  </div>
  <div class="roomListRoom__content">
    <a id="uu1" href=${url_room}>
    </a>
  </div>
  <div class="roomListRoom__meta">
    <a href=${url_room} class="roomListRoom__joined">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
        <title>user-group</title>
        <path
          d="M30.539 20.766c-2.69-1.547-5.75-2.427-8.92-2.662 0.649 0.291 1.303 0.575 1.918 0.928 0.715 0.412 1.288 1.005 1.71 1.694 1.507 0.419 2.956 1.003 4.298 1.774 0.281 0.162 0.456 0.487 0.456 0.85v4.65h-4v2h5c0.553 0 1-0.447 1-1v-5.65c0-1.077-0.56-2.067-1.461-2.584z"
        ></path>
        <path
          d="M22.539 20.766c-6.295-3.619-14.783-3.619-21.078 0-0.901 0.519-1.461 1.508-1.461 2.584v5.65c0 0.553 0.447 1 1 1h22c0.553 0 1-0.447 1-1v-5.651c0-1.075-0.56-2.064-1.461-2.583zM22 28h-20v-4.65c0-0.362 0.175-0.688 0.457-0.85 5.691-3.271 13.394-3.271 19.086 0 0.282 0.162 0.457 0.487 0.457 0.849v4.651z"
        ></path>
        <path
          d="M19.502 4.047c0.166-0.017 0.33-0.047 0.498-0.047 2.757 0 5 2.243 5 5s-2.243 5-5 5c-0.168 0-0.332-0.030-0.498-0.047-0.424 0.641-0.944 1.204-1.513 1.716 0.651 0.201 1.323 0.331 2.011 0.331 3.859 0 7-3.141 7-7s-3.141-7-7-7c-0.688 0-1.36 0.131-2.011 0.331 0.57 0.512 1.089 1.075 1.513 1.716z"
        ></path>
        <path
          d="M12 16c3.859 0 7-3.141 7-7s-3.141-7-7-7c-3.859 0-7 3.141-7 7s3.141 7 7 7zM12 4c2.757 0 5 2.243 5 5s-2.243 5-5 5-5-2.243-5-5c0-2.757 2.243-5 5-5z"
        ></path>
      </svg>
      ${dataa["newroomparticipants"]} Joined
    </a>
    <p class="roomListRoom__topic">${dataa["newroomtopic"]}</p>
  </div>
</div>`).insertBefore("#LoadBtn")
        document.getElementById("uu1").innerHTML = newroomname;
        document.getElementById("uu1").setAttribute("id", i);

$(`<div class="roomListRoom" name="roomss">
  <div class="roomListRoom__header">
    <a href=${url_userprofile1} class="roomListRoom__author">
      <div class="avatar avatar--small">
        <img src=${dataa["newroomhostavatar1"]} />
      </div>
      <span>@${dataa["newroomhost1"]}</span>
    </a>
    <div id="iht2" class="roomListRoom__actions" name="1a1">
      <span> ${dataa["roomgettimedifference1"]} ago </span>
    </div>
  </div>
  <div class="roomListRoom__content">
    <a id="uu1" href=${url_room1}>
    </a>
  </div>
  <div class="roomListRoom__meta">
    <a href=${url_room1} class="roomListRoom__joined">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
        <title>user-group</title>
        <path
          d="M30.539 20.766c-2.69-1.547-5.75-2.427-8.92-2.662 0.649 0.291 1.303 0.575 1.918 0.928 0.715 0.412 1.288 1.005 1.71 1.694 1.507 0.419 2.956 1.003 4.298 1.774 0.281 0.162 0.456 0.487 0.456 0.85v4.65h-4v2h5c0.553 0 1-0.447 1-1v-5.65c0-1.077-0.56-2.067-1.461-2.584z"
        ></path>
        <path
          d="M22.539 20.766c-6.295-3.619-14.783-3.619-21.078 0-0.901 0.519-1.461 1.508-1.461 2.584v5.65c0 0.553 0.447 1 1 1h22c0.553 0 1-0.447 1-1v-5.651c0-1.075-0.56-2.064-1.461-2.583zM22 28h-20v-4.65c0-0.362 0.175-0.688 0.457-0.85 5.691-3.271 13.394-3.271 19.086 0 0.282 0.162 0.457 0.487 0.457 0.849v4.651z"
        ></path>
        <path
          d="M19.502 4.047c0.166-0.017 0.33-0.047 0.498-0.047 2.757 0 5 2.243 5 5s-2.243 5-5 5c-0.168 0-0.332-0.030-0.498-0.047-0.424 0.641-0.944 1.204-1.513 1.716 0.651 0.201 1.323 0.331 2.011 0.331 3.859 0 7-3.141 7-7s-3.141-7-7-7c-0.688 0-1.36 0.131-2.011 0.331 0.57 0.512 1.089 1.075 1.513 1.716z"
        ></path>
        <path
          d="M12 16c3.859 0 7-3.141 7-7s-3.141-7-7-7c-3.859 0-7 3.141-7 7s3.141 7 7 7zM12 4c2.757 0 5 2.243 5 5s-2.243 5-5 5-5-2.243-5-5c0-2.757 2.243-5 5-5z"
        ></path>
      </svg>
      ${dataa["newroomparticipants1"]} Joined
    </a>
    <p class="roomListRoom__topic">${dataa["newroomtopic1"]}</p>
  </div>
</div>`).insertBefore("#LoadBtn");
        document.getElementById("uu1").innerHTML = newroomname1;
        document.getElementById("uu1").setAttribute("id", i+1);
        visible += 1;
        $(".avatar img").on('error', function () {
          $(this).attr("src", "/images/avatar.svg")
        });      
        }
      else if (visible == roomcount) {
          const newroomname = dataa["newroomname"];
          const newroomname1 = dataa["newroomname1"];
          var url_userprofile = "{% url 'userprofile' pk=12345 %}".replace(/12345/, dataa["newroomhostid"].toString());
          var url_room = "{% url 'room' pk=12345 %}".replace(/12345/, dataa["newroomid"].toString());
        $(`<div class="roomListRoom" name="roomss">
  <div class="roomListRoom__header">
    <a href=${url_userprofile} class="roomListRoom__author">
      <div class="avatar avatar--small">
        <img src=${dataa["newroomhostavatar"]} />
      </div>
      <span>@${dataa["newroomhost"]}</span>
    </a>
    <div id="iht" class="roomListRoom__actions" name="1a1">
      <span> ${dataa["roomgettimedifference"]} ago </span>
    </div>
  </div>
  <div class="roomListRoom__content">
    <a id="uu1" href=${url_room}>
    </a>
  </div>
  <div class="roomListRoom__meta">
    <a href=${url_room} class="roomListRoom__joined">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
        <title>user-group</title>
        <path
          d="M30.539 20.766c-2.69-1.547-5.75-2.427-8.92-2.662 0.649 0.291 1.303 0.575 1.918 0.928 0.715 0.412 1.288 1.005 1.71 1.694 1.507 0.419 2.956 1.003 4.298 1.774 0.281 0.162 0.456 0.487 0.456 0.85v4.65h-4v2h5c0.553 0 1-0.447 1-1v-5.65c0-1.077-0.56-2.067-1.461-2.584z"
        ></path>
        <path
          d="M22.539 20.766c-6.295-3.619-14.783-3.619-21.078 0-0.901 0.519-1.461 1.508-1.461 2.584v5.65c0 0.553 0.447 1 1 1h22c0.553 0 1-0.447 1-1v-5.651c0-1.075-0.56-2.064-1.461-2.583zM22 28h-20v-4.65c0-0.362 0.175-0.688 0.457-0.85 5.691-3.271 13.394-3.271 19.086 0 0.282 0.162 0.457 0.487 0.457 0.849v4.651z"
        ></path>
        <path
          d="M19.502 4.047c0.166-0.017 0.33-0.047 0.498-0.047 2.757 0 5 2.243 5 5s-2.243 5-5 5c-0.168 0-0.332-0.030-0.498-0.047-0.424 0.641-0.944 1.204-1.513 1.716 0.651 0.201 1.323 0.331 2.011 0.331 3.859 0 7-3.141 7-7s-3.141-7-7-7c-0.688 0-1.36 0.131-2.011 0.331 0.57 0.512 1.089 1.075 1.513 1.716z"
        ></path>
        <path
          d="M12 16c3.859 0 7-3.141 7-7s-3.141-7-7-7c-3.859 0-7 3.141-7 7s3.141 7 7 7zM12 4c2.757 0 5 2.243 5 5s-2.243 5-5 5-5-2.243-5-5c0-2.757 2.243-5 5-5z"
        ></path>
      </svg>
      ${dataa["newroomparticipants"]} Joined
    </a>
    <p class="roomListRoom__topic">${dataa["newroomtopic"]}</p>
  </div>
</div>`).insertBefore("#LoadBtn");

        document.getElementById("uu1").innerHTML = newroomname;
        document.getElementById("uu1").setAttribute("id", i);
        $(".avatar img").on('error', function () {
          $(this).attr("src", "/images/avatar.svg")
        });      
      }
      else {
        $("#LoadBtn").remove();
        $(".avatar img").on('error', function () {
          $(this).attr("src", "/images/avatar.svg")
        })      
      }
    }
  })  
}
}
  </script>
</main>
{% endblock %}
